<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ML&PLN Coach (All-in-one)</title>
  <style>
    :root{
      --bg:#0b1220;
      --panel:#0f1a2e;
      --panel2:#0c1526;
      --text:#e8eefc;
      --muted:#b7c3e6;
      --stroke:rgba(232,238,252,.12);
      --accent:#7dd3fc;
      --accent2:#a78bfa;
      --shadow: 0 12px 40px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Helvetica Neue", sans-serif;
      background: radial-gradient(1200px 700px at 20% 0%, rgba(167,139,250,.25), transparent 55%),
                  radial-gradient(1200px 700px at 80% 10%, rgba(125,211,252,.20), transparent 55%),
                  var(--bg);
      color: var(--text);
    }
    .app{
      max-width: 980px;
      margin: 0 auto;
      padding: 20px;
      min-height: 100vh;
      display:flex;
      flex-direction:column;
      gap:14px;
    }
    .topbar{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid var(--stroke);
      border-radius: 16px;
      padding: 14px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      box-shadow: var(--shadow);
    }
    .brand{display:flex; gap:12px; align-items:center;}
    .logo{
      width:40px;height:40px;border-radius:12px;
      background: linear-gradient(135deg, rgba(125,211,252,.28), rgba(167,139,250,.25));
      border:1px solid var(--stroke);
      display:flex;align-items:center;justify-content:center;
      font-size:20px;
    }
    .title{font-weight:750; letter-spacing:.2px}
    .subtitle{font-size:12px; color: var(--muted); margin-top:2px}
    .status{
      font-size:12px;
      color: var(--muted);
      padding:8px 10px;
      border-radius: 999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.03);
      user-select:none;
    }
    .chat{
      flex:1;
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border:1px solid var(--stroke);
      border-radius: 16px;
      padding: 14px;
      display:flex;
      flex-direction:column;
      gap:12px;
      box-shadow: var(--shadow);
    }
    .messages{
      flex:1;
      overflow:auto;
      padding: 6px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .msg{
      max-width: 82%;
      border:1px solid var(--stroke);
      border-radius: 14px;
      padding: 10px 12px;
      background: rgba(255,255,255,.03);
    }
    .msg.user{
      margin-left:auto;
      background: rgba(125,211,252,.10);
      border-color: rgba(125,211,252,.22);
    }
    .msg.bot{
      margin-right:auto;
      background: rgba(167,139,250,.10);
      border-color: rgba(167,139,250,.22);
    }
    .meta{
      display:flex;
      justify-content:space-between;
      gap:10px;
      font-size: 11px;
      color: var(--muted);
      margin-bottom:6px;
    }
    .content{font-size:14px; line-height:1.45; white-space:pre-wrap}
    .content code{
      display:block;
      padding:10px 12px;
      margin-top:8px;
      background: var(--panel2);
      border:1px solid var(--stroke);
      border-radius: 12px;
      overflow:auto;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 12.5px;
    }
    .quick{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      padding: 0 6px;
    }
    .chip{
      border-radius: 999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.03);
      color: var(--text);
      padding: 8px 10px;
      font-size: 12px;
      cursor:pointer;
    }
    .chip:hover{border-color: rgba(125,211,252,.35)}
    .composer{
      display:flex;
      gap:10px;
      padding: 0 6px 4px;
    }
    .composer input{
      flex:1;
      background: var(--panel);
      border:1px solid var(--stroke);
      color: var(--text);
      border-radius: 12px;
      padding: 12px 12px;
      outline:none;
    }
    .composer input:focus{border-color: rgba(125,211,252,.45)}
    .composer button{
      border:0;
      border-radius: 12px;
      padding: 12px 14px;
      cursor:pointer;
      color: #07101d;
      font-weight: 750;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
    }
    .footer{
      color: var(--muted);
      font-size: 12px;
      text-align:center;
      opacity:.95;
    }
  </style>
</head>
<body>
  <div class="app">
    <header class="topbar">
      <div class="brand">
        <div class="logo">ü§ñ</div>
        <div>
          <div class="title">ML&PLN Coach</div>
          <div class="subtitle">Aprenda Machine Learning e PLN com microaulas e quizzes</div>
        </div>
      </div>
      <div class="status" id="statusPill">Modo: Local</div>
    </header>

    <main class="chat">
      <div class="messages" id="messages"></div>

      <div class="quick">
        <button class="chip" data-quick="trilha ml">Trilha ML</button>
        <button class="chip" data-quick="trilha pln">Trilha PLN</button>
        <button class="chip" data-quick="quiz ml">Quiz ML</button>
        <button class="chip" data-quick="quiz pln">Quiz PLN</button>
        <button class="chip" data-quick="projeto guiado">Projeto guiado</button>
        <button class="chip" data-quick="me explica simples">Explica simples</button>
        <button class="chip" data-quick="exemplo python">Exemplo Python</button>
        <button class="chip" data-quick="reset">Reset</button>
      </div>

      <form class="composer" id="composer">
        <input
          id="input"
          type="text"
          placeholder="Digite: 'overfitting', 'embeddings', 'trilha pln', 'quiz ml'..."
          autocomplete="off"
        />
        <button id="send" type="submit">Enviar</button>
      </form>
    </main>

    <footer class="footer">
      <span>üí° Dica: escreva ‚Äúgloss√°rio: embeddings‚Äù ou ‚Äúme explica simples‚Äù.</span>
    </footer>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);
    const messagesEl = $("messages");
    const composer = $("composer");
    const inputEl = $("input");

    const state = {
      user: { name:null, level:null, goal:null, style:null, time:null },
      onboardingStep: 0,
      lastTopic: null,
      quiz: null
    };

    const KNOWLEDGE = {
      glossary: {
        "machine learning": "√Årea da IA em que modelos aprendem padr√µes a partir de dados para prever/decidir sem regras fixas.",
        "supervisionado": "Aprendizado com exemplos rotulados (X ‚Üí y). Ex.: classificar spam (spam/n√£o spam).",
        "n√£o supervisionado": "Aprendizado sem r√≥tulos, buscando estrutura/padr√µes. Ex.: clustering de clientes.",
        "overfitting": "Quando o modelo ‚Äúdecora‚Äù o treino e perde capacidade de generalizar para dados novos.",
        "underfitting": "Quando o modelo √© simples demais e n√£o aprende nem o padr√£o do treino.",
        "valida√ß√£o": "Processo para medir generaliza√ß√£o. Ex.: divis√£o treino/teste ou cross-validation.",
        "precision": "Entre os positivos previstos, quantos s√£o realmente positivos.",
        "recall": "Entre os positivos reais, quantos o modelo encontrou.",
        "f1": "M√©dia harm√¥nica entre precision e recall. √ötil quando h√° desbalanceamento.",
        "pln": "Processamento de Linguagem Natural: t√©cnicas para lidar com texto (classificar, extrair, gerar, etc.).",
        "tokeniza√ß√£o": "Quebra de texto em unidades (tokens) para processamento.",
        "embeddings": "Vetores que representam palavras/frases/textos em um espa√ßo num√©rico, capturando sem√¢ntica.",
        "transformers": "Arquitetura moderna (base de modelos como BERT/GPT) com aten√ß√£o para entender contexto."
      },
      lessons: {
        ml_basics: [
          { title: "ML: o que √© e como funciona", key: "ml1", answer: buildAnswer(
            "Machine Learning √© ensinar um modelo a aprender padr√µes a partir de dados.",
            "Em vez de codar regras (se/ent√£o) para tudo, voc√™ fornece exemplos e o modelo aprende uma fun√ß√£o que mapeia entradas (X) para sa√≠das (y).",
            "Ex.: prever churn: X = comportamento do cliente, y = sai/n√£o sai.",
            "Qual seu caso: voc√™ quer aprender para entrevista, projeto real ou s√≥ base te√≥rica?",
            "Se quiser, te guio pela trilha ML essencial (3 passos) ou j√° montamos um projeto simples."
          )}
        ],
        pln_basics: [
          { title: "PLN: do texto para n√∫meros", key: "pln1", answer: buildAnswer(
            "PLN come√ßa transformando texto em uma forma que modelos conseguem usar: n√∫meros.",
            "O fluxo cl√°ssico √©: limpar texto ‚Üí tokenizar ‚Üí representar (BoW/TF-IDF/embeddings) ‚Üí treinar um modelo ‚Üí avaliar.",
            "Ex.: classificar sentimento: 'amei' tende a vetor pr√≥ximo de '√≥timo', e longe de 'horr√≠vel' (em embeddings).",
            "Quer uma vis√£o cl√°ssica (TF-IDF) ou moderna (transformers/embeddings)?",
            "Posso te mostrar um exemplo em Python com scikit-learn (TF-IDF + Logistic Regression)."
          )}
        ]
      },
      examples: {
        python_tfidf_sentiment: `from sklearn.model_selection import train_test_split
from sklearn.pipeline import Pipeline
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.linear_model import LogisticRegression
from sklearn.metrics import classification_report

texts = [
  "amei o produto, chegou r√°pido", "horr√≠vel, veio quebrado", "muito bom e √∫til",
  "p√©ssima experi√™ncia, n√£o recomendo", "excelente atendimento", "n√£o gostei, atrasou"
]
labels = [1,0,1,0,1,0]  # 1=positivo, 0=negativo

X_train, X_test, y_train, y_test = train_test_split(texts, labels, test_size=0.33, random_state=42)

model = Pipeline([
  ("tfidf", TfidfVectorizer()),
  ("clf", LogisticRegression(max_iter=1000))
])

model.fit(X_train, y_train)
pred = model.predict(X_test)

print(classification_report(y_test, pred))`
      },
      trails: {
        ml: [
          "1) Conceitos: supervisionado vs n√£o supervisionado, treino/teste, overfitting",
          "2) Modelos: regress√£o log√≠stica, √°rvores, random forest, gradient boosting",
          "3) Avalia√ß√£o: m√©tricas, valida√ß√£o cruzada, tuning, pipeline e leakage"
        ],
        pln: [
          "1) Texto ‚Üí features: tokeniza√ß√£o, TF-IDF, n-grams",
          "2) Embeddings: word2vec, sentence embeddings, busca sem√¢ntica",
          "3) Transformers: BERT, fine-tuning, avalia√ß√£o e erros comuns"
        ]
      },
      projects: {
        guided: [
          "Projeto 1: Detector de Spam (TF-IDF + Logistic Regression)",
          "Projeto 2: Sentimento em reviews (TF-IDF + Linear SVM)",
          "Projeto 3: FAQ sem√¢ntica (embeddings + similaridade + top-k)"
        ]
      },
      quizzes: {
        ml: [
          {
            q: "Overfitting √© quando‚Ä¶",
            options: ["o modelo vai bem no treino e mal no teste", "o modelo erra tudo no treino", "o modelo n√£o usa valida√ß√£o"],
            correct: 0,
            explain: "Overfitting = memorizar treino e perder generaliza√ß√£o (teste pior)."
          },
          {
            q: "Quando voc√™ prioriza F1-score?",
            options: ["quando classes s√£o balanceadas e custo √© igual", "quando h√° desbalanceamento e quer equil√≠brio entre precision/recall", "apenas em regress√£o"],
            correct: 1,
            explain: "F1 √© √∫til quando existe desbalanceamento e voc√™ quer trade-off precision/recall."
          }
        ],
        pln: [
          {
            q: "Embeddings servem para‚Ä¶",
            options: ["transformar texto em vetores num√©ricos com sem√¢ntica", "corrigir ortografia automaticamente", "substituir valida√ß√£o"],
            correct: 0,
            explain: "Embeddings representam significado em vetores, permitindo similaridade e melhor modelagem."
          },
          {
            q: "Transformers se destacam por‚Ä¶",
            options: ["aten√ß√£o ao contexto em sequ√™ncia", "usar apenas BoW", "n√£o precisar de dados"],
            correct: 0,
            explain: "Aten√ß√£o (self-attention) ajuda a capturar depend√™ncias e contexto."
          }
        ]
      }
    };

    // ---------- UI helpers ----------
    function nowTime() {
      const d = new Date();
      return d.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });
    }

    function addMessage(role, text) {
      const wrap = document.createElement("div");
      wrap.className = `msg ${role}`;

      const meta = document.createElement("div");
      meta.className = "meta";
      meta.innerHTML = `<span>${role === "user" ? "Voc√™" : "Coach"}</span><span>${nowTime()}</span>`;

      const content = document.createElement("div");
      content.className = "content";

      const parts = splitByCodeFences(text);
      parts.forEach(part => {
        if (part.type === "code") {
          const code = document.createElement("code");
          code.textContent = part.value.trim();
          content.appendChild(code);
        } else {
          const p = document.createElement("div");
          p.textContent = part.value;
          content.appendChild(p);
        }
      });

      wrap.appendChild(meta);
      wrap.appendChild(content);
      messagesEl.appendChild(wrap);
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    function splitByCodeFences(text) {
      const out = [];
      const re = /```([\s\S]*?)```/g;
      let last = 0;
      let m;
      while ((m = re.exec(text)) !== null) {
        if (m.index > last) out.push({ type: "text", value: text.slice(last, m.index) });
        out.push({ type: "code", value: m[1] });
        last = m.index + m[0].length;
      }
      if (last < text.length) out.push({ type: "text", value: text.slice(last) });
      return out;
    }

    // ---------- Core response building ----------
    function buildAnswer(summary, explanation, example, check, next) {
      return [
        `‚úÖ Resumo: ${summary}`,
        `üß† Explica√ß√£o: ${explanation}`,
        `üß™ Exemplo: ${example}`,
        `‚ùì Checagem: ${check}`,
        `‚ûú Pr√≥ximo passo: ${next}`
      ].join("\n\n");
    }

    function normalize(text) {
      return text.trim().toLowerCase();
    }

    function detectIntent(text) {
      const t = normalize(text);

      if (t === "reset" || t.includes("reiniciar")) return { intent: "reset" };
      if (t.startsWith("gloss√°rio:") || t.startsWith("glossario:")) {
        return { intent: "glossary", term: t.split(":")[1]?.trim() || "" };
      }

      if (t.includes("trilha ml")) return { intent: "trail", domain: "ml" };
      if (t.includes("trilha pln") || t.includes("trilha nlp")) return { intent: "trail", domain: "pln" };

      if (t.includes("quiz ml")) return { intent: "quiz", domain: "ml" };
      if (t.includes("quiz pln") || t.includes("quiz nlp")) return { intent: "quiz", domain: "pln" };

      if (t.includes("exemplo python") || t.includes("c√≥digo python") || t.includes("codigo python")) {
        return { intent: "example_python" };
      }

      if (t.includes("me explica simples") || t.includes("explica simples") || t.includes("como se eu tivesse 10")) {
        return { intent: "simple_mode" };
      }

      if (t.includes("projeto guiado") || t.includes("projeto")) {
        return { intent: "project_guided" };
      }

      if (state.quiz && /^[abc123]$/.test(t)) return { intent: "quiz_answer", answer: t };

      const topics = ["overfitting","underfitting","precision","recall","f1","tokeniza√ß√£o","tokenizacao","embeddings","transformers","machine learning","pln","nlp","valida√ß√£o","validacao"];
      for (const k of topics) if (t.includes(k)) return { intent: "topic", topic: k };

      return { intent: "fallback" };
    }

    function onboardingReply(userText) {
      const t = normalize(userText);

      if (state.onboardingStep === 0) {
        state.onboardingStep = 1;
        return buildAnswer(
          "Antes de come√ßar, vou te conhecer rapidinho.",
          "Com 4 respostas eu monto sua trilha e deixo as aulas no seu ritmo.",
          "Pergunta 1/4: qual seu n√≠vel hoje? (iniciante / intermedi√°rio / avan√ßado)",
          "Responda com uma dessas tr√™s op√ß√µes.",
          "Depois disso eu pergunto objetivo e estilo."
        );
      }

      if (state.onboardingStep === 1) {
        if (t.includes("inic")) state.user.level = "iniciante";
        else if (t.includes("inter")) state.user.level = "intermedi√°rio";
        else if (t.includes("avan")) state.user.level = "avan√ßado";
        else return "Me diz seu n√≠vel com uma das op√ß√µes: iniciante / intermedi√°rio / avan√ßado.";

        state.onboardingStep = 2;
        return `Fechado: n√≠vel **${state.user.level}**.\n\nPergunta 2/4: qual seu objetivo? (aprender / entrevista / projeto / faculdade)`;
      }

      if (state.onboardingStep === 2) {
        if (t.includes("aprend")) state.user.goal = "aprender";
        else if (t.includes("entrev")) state.user.goal = "entrevista";
        else if (t.includes("proj")) state.user.goal = "projeto";
        else if (t.includes("facul")) state.user.goal = "faculdade";
        else return "Objetivo: aprender / entrevista / projeto / faculdade?";

        state.onboardingStep = 3;
        return `Boa. Objetivo: **${state.user.goal}**.\n\nPergunta 3/4: voc√™ prefere (teoria + analogias) ou (direto no c√≥digo) ou (exerc√≠cios)?`;
      }

      if (state.onboardingStep === 3) {
        if (t.includes("teoria") || t.includes("analogia")) state.user.style = "teoria";
        else if (t.includes("c√≥d") || t.includes("cod") || t.includes("python")) state.user.style = "codigo";
        else if (t.includes("exerc")) state.user.style = "exercicios";
        else return "Prefer√™ncia: teoria / c√≥digo / exerc√≠cios?";

        state.onboardingStep = 4;
        return `Perfeito. Estilo: **${state.user.style}**.\n\nPergunta 4/4: quanto tempo por dia? (10m / 30m / 1h)`;
      }

      if (state.onboardingStep === 4) {
        if (t.includes("10")) state.user.time = "10m";
        else if (t.includes("30")) state.user.time = "30m";
        else if (t.includes("1h") || t.includes("60")) state.user.time = "1h";
        else return "Tempo por dia: 10m / 30m / 1h ?";

        state.onboardingStep = 5;
        return buildAnswer(
          "Onboarding completo. Vou te guiar com microaulas no seu ritmo.",
          `Configura√ß√£o: n√≠vel=${state.user.level}, objetivo=${state.user.goal}, estilo=${state.user.style}, tempo=${state.user.time}.`,
          "Voc√™ pode pedir: 'trilha ml', 'trilha pln', 'quiz ml', 'overfitting', 'embeddings', 'exemplo python'.",
          "Qual tema voc√™ quer come√ßar agora: ML base ou PLN base?",
          "Se voc√™ disser 'ML', eu come√ßo pela aula 1 e te dou um exerc√≠cio curtinho."
        );
      }

      return null;
    }

    function topicReply(topic) {
      const t = topic;

      if (t.includes("overfitting")) {
        return buildAnswer(
          "Overfitting √© quando o modelo ‚Äòdecora‚Äô o treino e piora em dados novos.",
          "Ele aprende ru√≠dos/padr√µes espec√≠ficos do treino em vez do padr√£o geral. Acontece com modelo complexo + poucos dados ou features vazando informa√ß√£o.",
          "Sinal t√≠pico: treino muito alto (ex.: 99%) e teste bem menor (ex.: 70%).",
          "No seu caso, voc√™ est√° vendo treino alto e teste baixo? (sim/n√£o)",
          "Se sim, eu te mostro 3 corre√ß√µes: regulariza√ß√£o, valida√ß√£o correta e reduzir complexidade (com exemplo)."
        );
      }

      if (t.includes("underfitting")) {
        return buildAnswer(
          "Underfitting √© quando o modelo √© simples demais e n√£o aprende nem o treino.",
          "Voc√™ v√™ desempenho baixo tanto em treino quanto em teste. Geralmente falta capacidade do modelo, features ou ajuste adequado.",
          "Ex.: uma regress√£o linear tentando aprender um padr√£o muito n√£o-linear.",
          "Voc√™ est√° com m√©tricas baixas no treino tamb√©m?",
          "Se estiver, eu sugiro: melhorar features, tentar modelo mais expressivo e ajustar hiperpar√¢metros."
        );
      }

      if (t.includes("precision")) {
        return buildAnswer(
          "Precis√£o mede ‚Äòqu√£o confi√°veis‚Äô s√£o os positivos previstos.",
          "Precision = VP / (VP + FP). Boa quando falso positivo √© caro (ex.: bloquear pagamento leg√≠timo).",
          "Se o modelo marcou 100 como spam e 90 eram spam, precision = 0,90.",
          "No seu contexto, falso positivo √© caro ou falso negativo √© pior?",
          "Se falso negativo √© pior, provavelmente recall importa mais."
        );
      }

      if (t.includes("recall")) {
        return buildAnswer(
          "Recall mede ‚Äòquantos positivos reais‚Äô o modelo conseguiu encontrar.",
          "Recall = VP / (VP + FN). Importa quando perder um positivo √© caro (ex.: n√£o detectar fraude/doen√ßa).",
          "Se existiam 100 fraudes e voc√™ pegou 80, recall = 0,80.",
          "Voc√™ prefere errar por excesso (mais FP) para pegar quase tudo?",
          "Se sim, a gente otimiza recall e controla precision com threshold."
        );
      }

      if (t === "f1" || t.includes("f1")) {
        return buildAnswer(
          "F1 equilibra precision e recall em um √∫nico n√∫mero.",
          "F1 = 2 * (precision*recall)/(precision+recall). √ötil quando h√° desbalanceamento e voc√™ quer equil√≠brio.",
          "Ex.: precision=0,8 e recall=0,6 ‚Üí F1 ‚âà 0,686.",
          "Seu dataset √© desbalanceado? (ex.: 90% n√£o-spam, 10% spam)",
          "Se for, al√©m de F1, vale olhar matriz de confus√£o e ajustar threshold."
        );
      }

      if (t.includes("token")) {
        return buildAnswer(
          "Tokeniza√ß√£o √© quebrar o texto em unidades (tokens) para processamento.",
          "Pode ser por palavras, subpalavras (BPE/WordPiece) ou caracteres. Em transformers, subpalavras ajudam com vocabul√°rio grande.",
          "Ex.: 'intelig√™ncia artificial' ‚Üí ['intelig√™ncia', 'artificial'] (palavras) ou subpalavras.",
          "Voc√™ quer o jeito simples (word tokens) ou o moderno (subword tokens)?",
          "Se quiser, eu te explico BPE em 2 minutos com analogia."
        );
      }

      if (t.includes("embeddings")) {
        return buildAnswer(
          "Embeddings s√£o vetores que representam significado (sem√¢ntica) de texto.",
          "Textos semelhantes ficam pr√≥ximos no espa√ßo vetorial. Isso ajuda em busca sem√¢ntica, clustering, recomenda√ß√£o e classifica√ß√£o.",
          "Ex.: 'amei' fica mais perto de '√≥timo' do que de 'horr√≠vel' (em geral).",
          "Voc√™ quer usar embeddings para busca (FAQ) ou para classifica√ß√£o (sentimento/spam)?",
          "Se for FAQ, o pr√≥ximo passo √©: gerar embeddings + similaridade + top-k."
        );
      }

      if (t.includes("transformers")) {
        return buildAnswer(
          "Transformers s√£o modelos que usam aten√ß√£o para entender contexto em sequ√™ncias.",
          "Diferente de BoW, eles capturam depend√™ncias e significado com contexto (palavra muda de sentido conforme a frase).",
          "Ex.: 'banco' (financeiro) vs 'banco' (sentar) ‚Äî o contexto muda a representa√ß√£o.",
          "Voc√™ quer entender o conceito (aten√ß√£o) ou j√° ir para uso pr√°tico (fine-tuning)?",
          "Se voc√™ disser 'pr√°tico', eu te passo um caminho com dataset e avalia√ß√£o."
        );
      }

      if (t.includes("pln") || t.includes("nlp")) return KNOWLEDGE.lessons.pln_basics[0].answer;

      if (t.includes("valida")) {
        return buildAnswer(
          "Valida√ß√£o √© como voc√™ mede generaliza√ß√£o (se o modelo funciona fora do treino).",
          "O b√°sico √© treino/teste. Mais robusto √© cross-validation. O cuidado n¬∫1 √© evitar leakage (informa√ß√£o do futuro no treino).",
          "Ex.: normalizar usando dados do teste antes do split ‚Üí leakage.",
          "Voc√™ est√° usando split simples ou cross-validation?",
          "Se voc√™ me disser como est√° separando os dados, eu aponto riscos e melhorias."
        );
      }

      return KNOWLEDGE.lessons.ml_basics[0].answer;
    }

    function trailReply(domain) {
      const lines = KNOWLEDGE.trails[domain];
      const title = domain === "ml" ? "Trilha ML Essencial" : "Trilha PLN Essencial";
      return buildAnswer(
        `${title} (3 passos)`,
        "Eu vou seguindo com microaulas curtas e checagem de entendimento.",
        lines.join("\n"),
        "Quer come√ßar pelo passo 1 agora? (sim/n√£o)",
        "Se sim, eu te mando a aula 1 + um exerc√≠cio de 2 minutos."
      );
    }

    function projectGuidedReply() {
      return buildAnswer(
        "Vamos montar um projeto pr√°tico e simples que vira portf√≥lio.",
        "Projetos curtos te d√£o entendimento real: dados ‚Üí pipeline ‚Üí treino ‚Üí m√©trica ‚Üí itera√ß√£o.",
        KNOWLEDGE.projects.guided.join("\n"),
        "Qual voc√™ prefere: Spam, Sentimento ou FAQ sem√¢ntica?",
        "Escolheu? Eu te passo a lista de arquivos e o primeiro c√≥digo."
      );
    }

    function examplePythonReply() {
      return buildAnswer(
        "Aqui vai um exemplo pronto (TF-IDF + Regress√£o Log√≠stica) para classifica√ß√£o de texto.",
        "Voc√™ consegue rodar em poucos minutos e j√° ver m√©tricas. Depois d√° pra evoluir para SVM ou transformers.",
        "```" + KNOWLEDGE.examples.python_tfidf_sentiment + "```",
        "Quer que eu adapte para spam (PT-BR) ou sentimento (reviews)?",
        "Se voc√™ me disser o tipo de texto, eu ajusto dataset e m√©tricas."
      );
    }

    function simpleModeReply(lastTopic) {
      const topic = lastTopic || "machine learning";
      if (topic.includes("overfitting")) {
        return "‚úÖ Resumo: Overfitting √© como decorar a prova.\n\nüß† Explica√ß√£o: Voc√™ acerta tudo no treino porque memorizou, mas quando aparece uma pergunta nova, erra.\n\n‚ûú Pr√≥ximo passo: Quer 3 jeitos simples de evitar overfitting?";
      }
      if (topic.includes("embeddings")) {
        return "‚úÖ Resumo: Embeddings s√£o ‚Äòcoordenadas‚Äô do significado.\n\nüß† Explica√ß√£o: Palavras/frases parecidas ficam perto, diferentes ficam longe.\n\n‚ûú Pr√≥ximo passo: Quer um exemplo de busca sem√¢ntica (FAQ) em 3 passos?";
      }
      return "‚úÖ Resumo: ML √© aprender com exemplos.\n\nüß† Explica√ß√£o: Em vez de regras fixas, voc√™ mostra dados e o modelo aprende padr√µes.\n\n‚ûú Pr√≥ximo passo: Quer um exemplo simples com texto (PLN) ou n√∫meros (ML)?";
    }

    function startQuiz(domain) {
      state.quiz = { domain, idx: 0, score: 0 };
      return renderQuizQuestion();
    }

    function renderQuizQuestion() {
      const { domain, idx } = state.quiz;
      const item = KNOWLEDGE.quizzes[domain][idx];
      const opts = item.options.map((o, i) => `${String.fromCharCode(65+i)}) ${o}`).join("\n");
      return buildAnswer(
        `Quiz ${domain.toUpperCase()} ‚Äî Pergunta ${idx+1}/${KNOWLEDGE.quizzes[domain].length}`,
        item.q,
        opts,
        "Responda com A, B, C (ou 1, 2, 3).",
        "Eu corrijo e explico em seguida."
      );
    }

    function handleQuizAnswer(ansRaw) {
      const ans = normalize(ansRaw);
      const { domain, idx } = state.quiz;
      const item = KNOWLEDGE.quizzes[domain][idx];

      const map = { "a":0, "b":1, "c":2, "1":0, "2":1, "3":2 };
      const chosen = map[ans];
      let msg = "";

      if (chosen === item.correct) {
        state.quiz.score += 1;
        msg += `‚úÖ Acertou! ${item.explain}`;
      } else {
        msg += `‚ùå Quase. Resposta correta: ${String.fromCharCode(65+item.correct)}.\n${item.explain}`;
      }

      state.quiz.idx += 1;

      if (state.quiz.idx >= KNOWLEDGE.quizzes[domain].length) {
        const total = KNOWLEDGE.quizzes[domain].length;
        const score = state.quiz.score;
        state.quiz = null;
        msg += `\n\nüèÅ Fim do quiz! Sua pontua√ß√£o: ${score}/${total}.\n\n‚ûú Pr√≥ximo passo: Quer revisar algum tema (ex.: overfitting, embeddings) ou iniciar uma trilha?`;
        return msg;
      }

      return msg + "\n\n" + renderQuizQuestion();
    }

    function resetAll() {
      state.user = { name:null, level:null, goal:null, style:null, time:null };
      state.onboardingStep = 0;
      state.lastTopic = null;
      state.quiz = null;
      messagesEl.innerHTML = "";
      greet();
    }

    function respond(userText) {
      if (state.onboardingStep < 5) {
        const r = onboardingReply(userText);
        if (r) return r;
      }

      const { intent, domain, term, topic, answer } = detectIntent(userText);

      if (intent === "reset") {
        resetAll();
        return null;
      }

      if (intent === "glossary") {
        const key = (term || "").trim();
        if (!key) return "Escreva assim: gloss√°rio: embeddings";
        const found = KNOWLEDGE.glossary[key] || KNOWLEDGE.glossary[normalize(key)] || null;
        if (!found) return `N√£o achei "${key}" no meu gloss√°rio. Quer que eu explique com exemplo pr√°tico?`;
        state.lastTopic = key;
        return buildAnswer(
          `Gloss√°rio: ${key}`,
          found,
          "Se quiser, eu tamb√©m dou um exemplo aplicado ao seu caso.",
          "Quer um exemplo pr√°tico agora? (sim/n√£o)",
          "Voc√™ pode pedir: 'exemplo python' ou 'me explica simples'."
        );
      }

      if (intent === "trail") return trailReply(domain);
      if (intent === "project_guided") return projectGuidedReply();
      if (intent === "example_python") return examplePythonReply();
      if (intent === "simple_mode") return simpleModeReply(state.lastTopic);
      if (intent === "quiz") return startQuiz(domain);
      if (intent === "quiz_answer") return handleQuizAnswer(answer);
      if (intent === "topic") {
        state.lastTopic = topic;
        return topicReply(topic);
      }

      return buildAnswer(
        "Eu posso te ajudar nisso, s√≥ preciso de 1 detalhe.",
        "Me diga qual √© o seu foco agora: ML (modelos/m√©tricas) ou PLN (texto/embeddings/transformers).",
        "Exemplos que funcionam bem: 'overfitting', 'trilha ml', 'quiz pln', 'gloss√°rio: transformers'.",
        "Voc√™ quer mais teoria ou mais pr√°tica?",
        "Se voc√™ disser 'pr√°tica', eu te passo um mini projeto em 3 passos."
      );
    }

    function greet() {
      addMessage("bot", buildAnswer(
        "Eu sou seu ML&PLN Coach (modo local).",
        "Vou te ensinar Machine Learning e PLN em microaulas, com exemplos e quizzes.",
        "Primeiro: um onboarding bem r√°pido (4 perguntas).",
        "Topa? Responda qualquer coisa para come√ßar.",
        "Dica: voc√™ pode usar os bot√µes r√°pidos tamb√©m."
      ));
    }

    composer.addEventListener("submit", (e) => {
      e.preventDefault();
      const text = inputEl.value.trim();
      if (!text) return;
      inputEl.value = "";
      addMessage("user", text);

      const reply = respond(text);
      if (reply) addMessage("bot", reply);
    });

    document.querySelectorAll("[data-quick]").forEach(btn => {
      btn.addEventListener("click", () => {
        const text = btn.getAttribute("data-quick");
        inputEl.value = text;
        composer.requestSubmit();
      });
    });

    greet();
  </script>
</body>
</html>
